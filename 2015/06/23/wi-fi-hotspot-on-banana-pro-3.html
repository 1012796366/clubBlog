<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><script type=text/javascript>var host="vjudge1.github.io";host==window.location.host&&"https:"!=window.location.protocol&&(window.location.protocol="https");</script><title>Wi-Fi Hotspot on Banana Pro (3) - IPv6</title><meta name=description content="There is IPv6 in college. Why not use it?I expected that the thinking of IPv6 will be the same as IPv4. However, there is no NAT support in the IPv6 protocol..."><link rel=stylesheet href=/css/main.css><link rel=stylesheet type=text/css href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css><link rel=canonical href=https://vjudge1.github.io/2015/06/23/wi-fi-hotspot-on-banana-pro-3.html><link rel=alternate type=application/rss+xml title=Unorz href="https://vjudge1.github.io/feed.xml"><link type=application/atom+xml rel=alternate href=https://vjudge1.github.io/feed.xml><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js></script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.min.js></script><script type=text/javascript src=/static/js/index.js></script></head><body><header><nav class="navbar navbar-default"><div class=container><div class=navbar-header><button type=button class="navbar-toggle navbar-toggle-left collapsed" data-toggle=modal data-target=#nav-sidebar><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar><span class=sr-only>Toggle navigation</span> <span class="fa fa-angle-double-right icon"></span></button> <a class=navbar-brand href="/"><i class="fa fa-github-alt"></i> Unorz</a></div><div id=navbar class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href=/ data-toggle=tooltip data-placement=bottom title=Home><i class="fa fa-home"></i></a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=true data-toggle=tooltip data-placement=bottom title=Categories><i class="fa fa-th-list"></i><span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href="/categories/?c=All"><span class=badge style=float:right>43</span>All</a></li><li class=divider></li><li class=dropdown-header>Lists</li><li><a href="/categories/?c=Others"><span class=badge style=float:right>7</span>Others</a></li><li><a href="/categories/?c=Linux"><span class=badge style=float:right>12</span>Linux</a></li><li><a href="/categories/?c=Maintainance"><span class=badge style=float:right>4</span>Maintainance</a></li><li><a href="/categories/?c=Mac"><span class=badge style=float:right>5</span>Mac</a></li><li><a href="/categories/?c=GitHub"><span class=badge style=float:right>4</span>GitHub</a></li><li><a href="/categories/?c=Arduino"><span class=badge style=float:right>1</span>Arduino</a></li><li><a href="/categories/?c=fun"><span class=badge style=float:right>2</span>fun</a></li><li><a href="/categories/?c=Web"><span class=badge style=float:right>6</span>Web</a></li><li><a href="/categories/?c=others"><span class=badge style=float:right>1</span>others</a></li><li><a href="/categories/?c=Java"><span class=badge style=float:right>1</span>Java</a></li><li><a href="/categories/?c=Ruby"><span class=badge style=float:right>1</span>Ruby</a></li><li><a href="/categories/?c=Programming"><span class=badge style=float:right>4</span>Programming</a></li><li><a href="/categories/?c=Fun"><span class=badge style=float:right>1</span>Fun</a></li></ul></li><li><a href=/tags/ data-toggle=tooltip data-placement=bottom title=Tags><i class="fa fa-tags"></i></a></li><li><a href=/about/ data-toggle=tooltip data-placement=bottom title=About><i class="fa fa-file-o"></i></a></li><li><a href=https://github.com/vjudge1/vjudge1.github.io data-toggle=tooltip data-placement=bottom title="Source Code"><i class="fa fa-code icon"></i></a></li><li><a href=/feed.xml data-toggle=tooltip data-placement=bottom title=RSS><i class="fa fa-rss icon"></i></a></li></ul><form class="navbar-form navbar-right hidden-sm hidden-md hidden-lg" action="/search/"><div class=form-group><input placeholder=Regexp class=form-control name=s id=keyword></div></form></div></div></nav></header><div class=modal id=nav-sidebar tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class="modal-dialog nav-sidebar"><div class=title><a class=navbar-brand href="/">Unorz</a></div><div class=content id=nav-sidebar-content><h4 class="page-header text-muted"><i class="fa fa-search"></i> Search</h4><form action="/search/"><div class=form-group><input placeholder=Regexp class=form-control name=s id=keyword></div></form><h4 class="page-header text-muted"><i class="fa fa-th-list"></i> Categories</h4><div class=categories-list><a class=item href="/categories/?c=All" data-cate=All>All <span class=badge>43</span></a> <a class=item href="/categories/?c=Others" data-cate=Others>Others <span class=badge>7</span></a> <a class=item href="/categories/?c=Linux" data-cate=Linux>Linux <span class=badge>12</span></a> <a class=item href="/categories/?c=Maintainance" data-cate=Maintainance>Maintainance <span class=badge>4</span></a> <a class=item href="/categories/?c=Mac" data-cate=Mac>Mac <span class=badge>5</span></a> <a class=item href="/categories/?c=GitHub" data-cate=GitHub>GitHub <span class=badge>4</span></a> <a class=item href="/categories/?c=Arduino" data-cate=Arduino>Arduino <span class=badge>1</span></a> <a class=item href="/categories/?c=fun" data-cate=fun>fun <span class=badge>2</span></a> <a class=item href="/categories/?c=Web" data-cate=Web>Web <span class=badge>6</span></a> <a class=item href="/categories/?c=others" data-cate=others>others <span class=badge>1</span></a> <a class=item href="/categories/?c=Java" data-cate=Java>Java <span class=badge>1</span></a> <a class=item href="/categories/?c=Ruby" data-cate=Ruby>Ruby <span class=badge>1</span></a> <a class=item href="/categories/?c=Programming" data-cate=Programming>Programming <span class=badge>4</span></a> <a class=item href="/categories/?c=Fun" data-cate=Fun>Fun <span class=badge>1</span></a></div><h4 class="page-header text-muted"><i class="fa fa-tags"></i> Tags</h4><a href=/tags/#tag-Linux style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Linux</a>&nbsp; <a href=/tags/#tag-中文 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">中文</a>&nbsp; <a href=/tags/#tag-Hackintosh style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">Hackintosh</a>&nbsp; <a href=/tags/#tag-UEFI style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">UEFI</a>&nbsp; <a href=/tags/#tag-单片机 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">单片机</a>&nbsp; <a href=/tags/#tag-Jekyll style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Jekyll</a>&nbsp; <a href=/tags/#tag-GitHub style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">GitHub</a>&nbsp; <a href=/tags/#tag-Scripting style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Scripting</a>&nbsp; <a href=/tags/#tag-Arduino style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Arduino</a>&nbsp; <a href=/tags/#tag-Wireless style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">Wireless</a>&nbsp; <a href=/tags/#tag-hostapd style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">hostapd</a>&nbsp; <a href=/tags/#tag-Windows style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Windows</a>&nbsp; <a href=/tags/#tag-LaTeX style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">LaTeX</a>&nbsp; <a href=/tags/#tag-Ubuntu style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Ubuntu</a>&nbsp; <a href=/tags/#tag-教务系统 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">教务系统</a>&nbsp; <a href=/tags/#tag-Mac style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Mac</a>&nbsp; <a href=/tags/#tag-NTFS style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">NTFS</a>&nbsp; <a href=/tags/#tag-Request style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Request</a>&nbsp; <a href=/tags/#tag-C style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">C</a>&nbsp; <a href=/tags/#tag-CGI style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">CGI</a>&nbsp; <a href=/tags/#tag-Session style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Session</a>&nbsp; <a href=/tags/#tag-IPv6 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">IPv6</a>&nbsp; <a href=/tags/#tag-Synergy style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Synergy</a>&nbsp; <a href=/tags/#tag-Rails style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Rails</a>&nbsp; <a href=/tags/#tag-Dash style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Dash</a>&nbsp; <a href=/tags/#tag-API style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">API</a>&nbsp; <a href=/tags/#tag-wine style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">wine</a>&nbsp; <a href=/tags/#tag-插件 style=font-size:18pt;color:#000 data-toggle=tooltip data-placement=top title="4 articles">插件</a>&nbsp;<h4 class="page-header text-muted"><i class="fa fa-external-link"></i> Links</h4><ul class="link-list fa-ul"><li><i class="fa-li fa fa-link"></i><a href=https://upclinux.github.io data-toggle=tooltip data-placement=bottom title=https://upclinux.github.io>UPC Linux</a></li><li><i class="fa-li fa fa-link"></i><a href=https://upclinux.github.io/intro/ data-toggle=tooltip data-placement=bottom title="https://upclinux.github.io/intro/">UPC Linux / Intro</a></li><li><i class="fa-li fa fa-link"></i><a href=http://www.lihuanyu.com data-toggle=tooltip data-placement=bottom title=http://www.lihuanyu.com>环宇的博客</a></li><li><i class="fa-li fa fa-link"></i><a href=http://wangchenyu.net.cn data-toggle=tooltip data-placement=bottom title=http://wangchenyu.net.cn>微尘风景BBS</a></li><li><i class="fa-li fa fa-link"></i><a href=http://jerry.weighingproduct.com data-toggle=tooltip data-placement=bottom title=http://jerry.weighingproduct.com>Jerry Yuan</a></li></ul></div></div></div><div class=jumbotron><div class=container><h1 class=post-title id=post-title><a href="/">Wi-Fi Hotspot on Banana Pro (3) - IPv6</a></h1><p><span class="glyphicon glyphicon-calendar"></span> Jun 23, 2015 &nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-user"></span> vjudge1 &nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-th-list"></span> <a href="/categories/?c=Linux">Linux</a> &nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-tags"></span>&nbsp; <a href=/tags/#tag-Wireless>Wireless</a> <a href=/tags/#tag-IPv6>IPv6</a></p></div></div><div id=main class="container main"><div class=row><div class=col-md-8 role=main><article class=article><ul id=markdown-toc><li><a href=#dhcp-server-ipv4 id=markdown-toc-dhcp-server-ipv4>DHCP Server (IPv4)</a><ul><li><a href=#auto-start id=markdown-toc-auto-start>Auto start</a></li></ul></li><li><a href=#network-configuration id=markdown-toc-network-configuration>Network Configuration</a><ul><li><a href=#set-ip id=markdown-toc-set-ip>Set IP</a></li></ul></li><li><a href=#dhcp-server-ipv6 id=markdown-toc-dhcp-server-ipv6>DHCP Server (IPv6)</a><ul><li><a href=#configure-dhcpd id=markdown-toc-configure-dhcpd>Configure dhcpd</a></li><li><a href=#etcinitddhcpd6 id=markdown-toc-etcinitddhcpd6>/etc/init.d/dhcpd6</a></li><li><a href=#start-the-dhcp-server id=markdown-toc-start-the-dhcp-server>Start the DHCP server</a></li></ul></li><li><a href=#nat id=markdown-toc-nat>NAT</a></li><li><a href=#references id=markdown-toc-references>References</a></li></ul><p>There is IPv6 in college. Why not use it?</p><p>I expected that the thinking of IPv6 will be the same as IPv4. However, there is no NAT support in the IPv6 protocol. So…</p><h2 id=dhcp-server-ipv4>DHCP Server (IPv4)</h2><p>I used <code class=highlighter-rouge>udhcpd</code> as the DHCP Server. Now, I must give it up (<code class=highlighter-rouge>update-rc.d udhcpd disable</code>) because it doesn’t support IPv6 at all.</p><p>I’ll use <code class=highlighter-rouge>isc-dhcp-server</code> now:</p><div class=highlighter-rouge><pre class=highlight><code>apt-get install isc-dhcp-server
</code></pre></div><p>Edit <code class=highlighter-rouge>/etc/default/isc-dhcp-server</code> and modify it to:</p><div class=highlighter-rouge><pre class=highlight><code>INTERFACES="wlan0"
</code></pre></div><p>Edit <code class=highlighter-rouge>/etc/dhcpd/dhcpd.conf</code> and add:</p><div class=highlighter-rouge><pre class=highlight><code>option routers 192.168.100.1;
subnet 192.168.100.0 netmask 255.255.255.0 {
    range 192.168.100.100 192.168.100.200;
    option domain-name-servers 114.114.114.114;
    option broadcast-address 192.168.100.255;
}
</code></pre></div><h3 id=auto-start>Auto start</h3><p>Just type the following commands in commandline:</p><div class=highlighter-rouge><pre class=highlight><code>service isc-dhcp-server restart
update-rc.d isc-dhcp-server enable
</code></pre></div><h2 id=network-configuration>Network Configuration</h2><h3 id=set-ip>Set IP</h3><p>Type the following command:</p><div class=highlighter-rouge><pre class=highlight><code>ifconfig wlan0 inet6 add 2001:db8:0:1::1/64
</code></pre></div><p>It can’t be saved after rebooting, so we should modify <code class=highlighter-rouge>/etc/network/interfaces</code> and add:</p><div class=highlighter-rouge><pre class=highlight><code>iface eth0 inet6 auto
iface wlan0 inet6 static
    address 2001:db8:0:1::1
    netmask 64
</code></pre></div><h2 id=dhcp-server-ipv6>DHCP Server (IPv6)</h2><h3 id=configure-dhcpd>Configure dhcpd</h3><p>Add a new file <code class=highlighter-rouge>/etc/dhcp/dhcpd6.conf</code> and type:</p><p>ddns-update-style none;</p><div class=highlighter-rouge><pre class=highlight><code>default-lease-time 6000;
max-lease-time 86400;
log-facility local7;

option dhcp6.name-servers 2001:4860:4860::8888;
option dhcp6.domain-search "test.example.com","example.com";

subnet6 2001:db8:0:1::/64 {
    range6 2001:db8:0:1::100 2001:db8:0:1::ffff;
}
</code></pre></div><h3 id=etcinitddhcpd6>/etc/init.d/dhcpd6</h3><p>Copy the following codes to <code class=highlighter-rouge>/etc/init.d/dhcpd6</code>:</p><div class=highlighter-rouge><pre class=highlight><code><span class=c>#!/bin/sh</span>
<span class=c>#</span>
<span class=c># $Id: isc dhcp server.init.d,v 4.2.1-P1 2011/04/05 /usr/local/sbin/dhcpd$</span>
<span class=c>#</span>

<span class=c>### BEGIN INIT INFO</span>
<span class=c># Provides:          dhcpd-server</span>
<span class=c># Required-Start:    $remote_fs $network $syslog</span>
<span class=c># Required-Stop:     $remote_fs $network $syslog</span>
<span class=c># Should-Start:      $local_fs slapd</span>
<span class=c># Should-Stop:       $local_fs slapd</span>
<span class=c># Default-Start:     2 3 4 5</span>
<span class=c># Default-Stop:      1</span>
<span class=c># Short-Description: DHCP server</span>
<span class=c># Description:       Dynamic Host Configuration Protocol Server</span>
<span class=c>### END INIT INFO</span>

<span class=nv>PATH</span><span class=o>=</span>/sbin:/bin:/usr/sbin:/usr/bin

<span class=c># config file</span>
<span class=nv>NAME</span><span class=o>=</span>dhcpd6
<span class=nv>DESC</span><span class=o>=</span><span class=s2>"DHCP IPv6 server"</span>
<span class=nv>INTERFACES</span><span class=o>=</span><span class=s2>"wlan0"</span>

<span class=nv>SERVER</span><span class=o>=</span>/usr/sbin/dhcpd
<span class=nv>SERVERARGS</span><span class=o>=</span><span class=s2>"-6"</span>
<span class=nv>CONFIGFILE</span><span class=o>=</span>/etc/dhcp/dhcpd6.conf
<span class=nv>LIBFOLDER</span><span class=o>=</span>/var/lib/dhcp
<span class=nv>LEASEFILE</span><span class=o>=</span><span class=s2>"</span><span class=k>${</span><span class=nv>LIBFOLDER</span><span class=k>}</span><span class=s2>/dhcpd6.leases"</span>
<span class=nv>RUNFOLDER</span><span class=o>=</span>/var/run/dhcp
<span class=nv>DHCPDPID</span><span class=o>=</span><span class=s2>"</span><span class=k>${</span><span class=nv>RUNFOLDER</span><span class=k>}</span><span class=s2>/dhcpd6.pid"</span>


<span class=c># check filetypes/values</span>
<span class=nb>test</span> -f <span class=s2>"</span><span class=k>${</span><span class=nv>SERVER</span><span class=k>}</span><span class=s2>"</span> <span class=o>||</span> <span class=nb>exit </span>0

<span class=c># include all init functions</span>
. /lib/lsb/init-functions

test_config<span class=o>()</span>
<span class=o>{</span>
 <span class=c># 1.) check config</span>
 <span class=k>if</span> <span class=o>[</span> ! <span class=s2>"</span><span class=k>${</span><span class=nv>SERVER</span><span class=k>}</span><span class=s2>"</span> <span class=s2>"</span><span class=k>${</span><span class=nv>SERVERARGS</span><span class=k>}</span><span class=s2>"</span> -t -q -cf <span class=s2>"</span><span class=k>${</span><span class=nv>CONFIGFILE</span><span class=k>}</span><span class=s2>"</span> &gt; /dev/null 2&gt;&amp;1 <span class=o>]</span>; <span class=k>then
   </span><span class=nb>echo</span> <span class=s2>"</span><span class=k>${</span><span class=nv>NAME</span><span class=k>}</span><span class=s2> self-test failed. Please fix the config file."</span>
   <span class=nb>echo</span> <span class=s2>"The error was: "</span>
   <span class=s2>"</span><span class=k>${</span><span class=nv>SERVER</span><span class=k>}</span><span class=s2>"</span> <span class=s2>"</span><span class=k>${</span><span class=nv>SERVERARGS</span><span class=k>}</span><span class=s2>"</span> -t -cf <span class=s2>"</span><span class=k>${</span><span class=nv>CONFIGFILE</span><span class=k>}</span><span class=s2>"</span>
   <span class=nb>exit </span>1
 <span class=k>fi</span>

 <span class=c># 2.) test_config will started if someone wants to start the server</span>
 <span class=c># test if the server is currently running</span>
 <span class=k>if</span> <span class=o>[</span> <span class=s2>"</span><span class=k>${</span><span class=nv>1</span><span class=k>}</span><span class=s2>"</span> <span class=o>=</span> <span class=s2>"start"</span> <span class=o>]</span>; <span class=k>then
   if</span> <span class=o>[</span> -e <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span> <span class=o>]</span>; <span class=k>then
     </span>stop_server <span class=s2>"Currently running instance of </span><span class=k>${</span><span class=nv>DESC</span><span class=k>}</span><span class=s2> found (PID: </span><span class=sb>`</span>cat <span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=sb>`</span><span class=s2>) - will now stop this instance"</span>
   <span class=k>fi
 fi</span>
<span class=o>}</span>

stop_server<span class=o>(){</span>
 <span class=k>if</span> <span class=o>[</span> <span class=s2>"</span><span class=k>${</span><span class=nv>1</span><span class=k>}</span><span class=s2>"</span> !<span class=o>=</span> <span class=s2>""</span> <span class=o>]</span>; <span class=k>then
  </span>log_daemon_msg <span class=s2>"</span><span class=k>${</span><span class=nv>1</span><span class=k>}</span><span class=s2>"</span>
 <span class=k>fi

 if</span> <span class=o>[</span> -e <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span> <span class=o>]</span>; <span class=k>then
   </span>log_daemon_msg <span class=s2>"Stopping </span><span class=k>${</span><span class=nv>DESC</span><span class=k>}</span><span class=s2> </span><span class=k>${</span><span class=nv>NAME</span><span class=k>}</span><span class=s2> [</span><span class=sb>`</span>cat <span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=sb>`</span><span class=s2>]"</span>
   start-stop-daemon --stop --quiet --pidfile <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span>
   log_end_msg <span class=nv>$?</span>
   rm -f <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span>
 <span class=k>else
   </span>log_daemon_msg <span class=s2>"Stopping </span><span class=k>${</span><span class=nv>DESC</span><span class=k>}</span><span class=s2> </span><span class=k>${</span><span class=nv>NAME</span><span class=k>}</span><span class=s2>: nothing do do, no pidfile found"</span>
 <span class=k>fi</span>
<span class=o>}</span>

<span class=c># single arg is -v for messages, -q for none</span>
check_status<span class=o>(){</span>
 <span class=k>if</span> <span class=o>[</span> ! -r <span class=s2>"</span><span class=nv>$DHCPDPID</span><span class=s2>"</span> <span class=o>]</span>; <span class=k>then
   </span><span class=nb>test</span> <span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span> !<span class=o>=</span> -v <span class=o>||</span> <span class=nb>echo</span> <span class=s2>"</span><span class=nv>$NAME</span><span class=s2> is not running."</span>
   <span class=k>return </span>3
 <span class=k>fi

 if </span><span class=nb>read </span>pid &lt; <span class=s2>"</span><span class=nv>$DHCPDPID</span><span class=s2>"</span> <span class=o>&amp;&amp;</span> ps -p <span class=s2>"</span><span class=nv>$pid</span><span class=s2>"</span> &gt; /dev/null 2&gt;&amp;1; <span class=k>then
   </span><span class=nb>test</span> <span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span> !<span class=o>=</span> -v <span class=o>||</span> <span class=nb>echo</span> <span class=s2>"</span><span class=nv>$NAME</span><span class=s2> is running."</span>
   <span class=k>return </span>0
 <span class=k>else
   </span><span class=nb>test</span> <span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span> !<span class=o>=</span> -v <span class=o>||</span> <span class=nb>echo</span> <span class=s2>"</span><span class=nv>$NAME</span><span class=s2> is not running but </span><span class=nv>$DHCPDPID</span><span class=s2> exists."</span>
   <span class=k>return </span>1
 <span class=k>fi</span>
<span class=o>}</span>

<span class=k>case</span> <span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span> <span class=k>in
 </span>start<span class=p>)</span>
   test_config <span class=k>${</span><span class=nv>1</span><span class=k>}</span>
   log_daemon_msg <span class=s2>"Starting </span><span class=k>${</span><span class=nv>DESC</span><span class=k>}</span><span class=s2> </span><span class=k>${</span><span class=nv>NAME</span><span class=k>}</span><span class=s2>"</span>

   <span class=c># allow dhcp server to write lease and pid file</span>
   <span class=k>if</span> <span class=o>[</span> ! -e <span class=s2>"</span><span class=k>${</span><span class=nv>RUNFOLDER</span><span class=k>}</span><span class=s2>"</span> <span class=o>]</span>; <span class=k>then</span>
     <span class=c># create run folder</span>
     mkdir -p <span class=s2>"</span><span class=k>${</span><span class=nv>RUNFOLDER</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${RUNFOLDER}"</span>

     <span class=c># create pid file</span>
     touch <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${DHCPDPID}"</span>
   <span class=k>else</span>
      <span class=c># create pid file</span>
     touch <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${DHCPDPID}"</span>
   <span class=k>fi

   if</span> <span class=o>[</span> ! -e <span class=s2>"</span><span class=k>${</span><span class=nv>LIBFOLDER</span><span class=k>}</span><span class=s2>"</span> <span class=o>]</span>; <span class=k>then</span>
     <span class=c># create run folder</span>
     mkdir -p <span class=s2>"</span><span class=k>${</span><span class=nv>LIBFOLDER</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${LIBFOLDER}"</span>

     <span class=c># create lease file</span>
     touch <span class=s2>"</span><span class=k>${</span><span class=nv>LEASEFILE</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${LEASEFILE}"</span>
   <span class=k>else</span>
      <span class=c># create pid file</span>
     touch <span class=s2>"</span><span class=k>${</span><span class=nv>LEASEFILE</span><span class=k>}</span><span class=s2>"</span>
     <span class=c>#chown dhcpd:dhcpd "${LEASEFILE}"</span>
   <span class=k>fi

   </span>start-stop-daemon --start --quiet --pidfile <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span> --exec <span class=s2>"</span><span class=k>${</span><span class=nv>SERVER</span><span class=k>}</span><span class=s2>"</span> -- <span class=s2>"</span><span class=k>${</span><span class=nv>SERVERARGS</span><span class=k>}</span><span class=s2>"</span> -q -pf <span class=s2>"</span><span class=k>${</span><span class=nv>DHCPDPID</span><span class=k>}</span><span class=s2>"</span> -cf <span class=s2>"</span><span class=k>${</span><span class=nv>CONFIGFILE</span><span class=k>}</span><span class=s2>"</span>  -lf <span class=s2>"</span><span class=k>${</span><span class=nv>LEASEFILE</span><span class=k>}</span><span class=s2>"</span> <span class=s2>"</span><span class=k>${</span><span class=nv>INTERFACES</span><span class=k>}</span><span class=s2>"</span>
   sleep 2


   <span class=k>if </span>check_status -q; <span class=k>then
     </span>log_end_msg 0
   <span class=k>else
     </span>log_failure_msg <span class=s2>"check syslog for diagnostics."</span>
     log_end_msg 1
     <span class=nb>exit </span>1
   <span class=k>fi</span>
   <span class=p>;;</span>
 stop<span class=p>)</span>
   <span class=c># stop dhcp server</span>
   stop_server
   <span class=p>;;</span>

 restart <span class=p>|</span> force-reload<span class=p>)</span>
   test_config
   <span class=nv>$0</span> stop
   sleep 2
   <span class=nv>$0</span> start
   <span class=k>if</span> <span class=o>[</span> <span class=s2>"</span><span class=nv>$?</span><span class=s2>"</span> !<span class=o>=</span> <span class=s2>"0"</span> <span class=o>]</span>; <span class=k>then
     </span><span class=nb>exit </span>1
   <span class=k>fi</span>
   <span class=p>;;</span>
 status<span class=p>)</span>
   <span class=nb>echo</span> -n <span class=s2>"Status of </span><span class=nv>$DESC</span><span class=s2>: "</span>
   check_status -v
   <span class=nb>exit</span> <span class=s2>"</span><span class=nv>$?</span><span class=s2>"</span>
   <span class=p>;;</span>
 <span class=k>*</span><span class=p>)</span>
   <span class=nb>echo</span> <span class=s2>"Usage: </span><span class=nv>$0</span><span class=s2> {start|stop|restart|force-reload|status}"</span>
   <span class=nb>exit </span>1
<span class=k>esac

</span><span class=nb>exit </span>0
</code></pre></div><h3 id=start-the-dhcp-server>Start the DHCP server</h3><p>Type:</p><div class=highlighter-rouge><pre class=highlight><code>chmod +x /etc/init.d/dhcpd6
touch /var/lib/dhcp/dhcpd6.leases
#chown dhcpd:dhcpd /var/lib/dhcp/dhcpd6.leases
</code></pre></div><p>Then type:</p><div class=highlighter-rouge><pre class=highlight><code>service dhcpd6 start
update-rc.d dhcpd6 defaults
</code></pre></div><h2 id=nat>NAT</h2><p>IPv6 doesn’t support NAT and forwarding. So we need hack.</p><h2 id=references>References</h2><ul><li><a href=https://www.sixxs.net/wiki/Configuring_ISC_DHCPv6_Server>Configuring ISC DHCPv6 Server</a></li><li><a href="http://strugglers.net/~andy/blog/2011/09/04/linux-ipv6-router-advertisements-and-forwarding/">Linux, IPv6, router advertisements and forwarding</a></li><li><a href="http://koo.fi/blog/2013/03/20/linux-ipv6-router-radvd-dhcpv6/">Linux IPv6 Router: RADVD + DHCPv6</a></li><li><a href="https://bigeagle.me/2011/11/linux_as_ipv6_gateway/">Linux 用作 IPv6 网关</a></li><li><a href=http://yangwenbo.com/articles/ipv6-route-error-fix.html>IPV6 获取地址却无法使用的解决方案</a></li></ul></article><div class=text-right><ul class=sharelist><li><a href=# class=share data-target=weibo data-toggle=tooltip title="Share on Weibo"><i class="fa fa-weibo"></i></a></li><li><a href=# class=share data-target=linkedin data-toggle=tooltip title="Share on LinkedIn"><i class="fa fa-linkedin-square"></i></a></li><li><a href=# class=share data-target=facebook data-toggle=tooltip title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li><li><a href=# class=share data-target=twitter data-toggle=tooltip title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li><li><span class=text-muted>Share this post:</span></li></ul><script src=/static/js/share.js></script></div><br class=clear><div class="post-area post comment"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname="vjudge1";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div><br class=clear></div><div id=content class="col-sm-4 hidden-xs hidden-sm"></div></div></div><div id=sidebar style=display:none><h4 class="page-header text-muted"><i class="fa fa-search"></i> Search</h4><form action="/search/"><div class=form-group><input placeholder=Regexp class=form-control name=s id=keyword></div></form><h4 class="page-header text-muted"><i class="fa fa-th-list"></i> Categories</h4><div class=categories-list><a class=item href="/categories/?c=All" data-cate=All>All <span class=badge>43</span></a> <a class=item href="/categories/?c=Others" data-cate=Others>Others <span class=badge>7</span></a> <a class=item href="/categories/?c=Linux" data-cate=Linux>Linux <span class=badge>12</span></a> <a class=item href="/categories/?c=Maintainance" data-cate=Maintainance>Maintainance <span class=badge>4</span></a> <a class=item href="/categories/?c=Mac" data-cate=Mac>Mac <span class=badge>5</span></a> <a class=item href="/categories/?c=GitHub" data-cate=GitHub>GitHub <span class=badge>4</span></a> <a class=item href="/categories/?c=Arduino" data-cate=Arduino>Arduino <span class=badge>1</span></a> <a class=item href="/categories/?c=fun" data-cate=fun>fun <span class=badge>2</span></a> <a class=item href="/categories/?c=Web" data-cate=Web>Web <span class=badge>6</span></a> <a class=item href="/categories/?c=others" data-cate=others>others <span class=badge>1</span></a> <a class=item href="/categories/?c=Java" data-cate=Java>Java <span class=badge>1</span></a> <a class=item href="/categories/?c=Ruby" data-cate=Ruby>Ruby <span class=badge>1</span></a> <a class=item href="/categories/?c=Programming" data-cate=Programming>Programming <span class=badge>4</span></a> <a class=item href="/categories/?c=Fun" data-cate=Fun>Fun <span class=badge>1</span></a></div><h4 class="page-header text-muted"><i class="fa fa-tags"></i> Tags</h4><a href=/tags/#tag-Linux style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Linux</a>&nbsp; <a href=/tags/#tag-中文 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">中文</a>&nbsp; <a href=/tags/#tag-Hackintosh style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">Hackintosh</a>&nbsp; <a href=/tags/#tag-UEFI style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">UEFI</a>&nbsp; <a href=/tags/#tag-单片机 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">单片机</a>&nbsp; <a href=/tags/#tag-Jekyll style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Jekyll</a>&nbsp; <a href=/tags/#tag-GitHub style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">GitHub</a>&nbsp; <a href=/tags/#tag-Scripting style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">Scripting</a>&nbsp; <a href=/tags/#tag-Arduino style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Arduino</a>&nbsp; <a href=/tags/#tag-Wireless style=font-size:15pt;color:#333 data-toggle=tooltip data-placement=top title="3 articles">Wireless</a>&nbsp; <a href=/tags/#tag-hostapd style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">hostapd</a>&nbsp; <a href=/tags/#tag-Windows style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Windows</a>&nbsp; <a href=/tags/#tag-LaTeX style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">LaTeX</a>&nbsp; <a href=/tags/#tag-Ubuntu style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Ubuntu</a>&nbsp; <a href=/tags/#tag-教务系统 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">教务系统</a>&nbsp; <a href=/tags/#tag-Mac style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Mac</a>&nbsp; <a href=/tags/#tag-NTFS style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">NTFS</a>&nbsp; <a href=/tags/#tag-Request style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Request</a>&nbsp; <a href=/tags/#tag-C style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">C</a>&nbsp; <a href=/tags/#tag-CGI style=font-size:12pt;color:#666 data-toggle=tooltip data-placement=top title="2 articles">CGI</a>&nbsp; <a href=/tags/#tag-Session style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Session</a>&nbsp; <a href=/tags/#tag-IPv6 style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">IPv6</a>&nbsp; <a href=/tags/#tag-Synergy style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Synergy</a>&nbsp; <a href=/tags/#tag-Rails style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Rails</a>&nbsp; <a href=/tags/#tag-Dash style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">Dash</a>&nbsp; <a href=/tags/#tag-API style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">API</a>&nbsp; <a href=/tags/#tag-wine style=font-size:9pt;color:#999 data-toggle=tooltip data-placement=top title="1 article">wine</a>&nbsp; <a href=/tags/#tag-插件 style=font-size:18pt;color:#000 data-toggle=tooltip data-placement=top title="4 articles">插件</a>&nbsp;<h4 class="page-header text-muted"><i class="fa fa-external-link"></i> Links</h4><ul class="link-list fa-ul"><li><i class="fa-li fa fa-link"></i><a href=https://upclinux.github.io data-toggle=tooltip data-placement=bottom title=https://upclinux.github.io>UPC Linux</a></li><li><i class="fa-li fa fa-link"></i><a href=https://upclinux.github.io/intro/ data-toggle=tooltip data-placement=bottom title="https://upclinux.github.io/intro/">UPC Linux / Intro</a></li><li><i class="fa-li fa fa-link"></i><a href=http://www.lihuanyu.com data-toggle=tooltip data-placement=bottom title=http://www.lihuanyu.com>环宇的博客</a></li><li><i class="fa-li fa fa-link"></i><a href=http://wangchenyu.net.cn data-toggle=tooltip data-placement=bottom title=http://wangchenyu.net.cn>微尘风景BBS</a></li><li><i class="fa-li fa fa-link"></i><a href=http://jerry.weighingproduct.com data-toggle=tooltip data-placement=bottom title=http://jerry.weighingproduct.com>Jerry Yuan</a></li></ul></div><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js></script><script type=text/javascript>anchors.options.placement="left",anchors.add("article h1,h2,h3,h4");</script><script type=text/javascript src=/static/js/callout.js></script><div id=top data-toggle=tooltip data-placement=left title="Back to top"><a href=javascript:;><div class=arrow></div><div class=stick></div></a></div><footer class=site-footer><div class=container><ol class=footer-list><li>&copy; 2015 vjudge1</li><li><a href="/about/">About</a></li><li><a href=mailto:vjudge404@gmail.com>Email</a></li><li><a href=https://github.com/vjudge1>GitHub</a></li><li><a href=https://twitter.com/vjudge404>Twitter</a></li><li><a href=https://www.facebook.com/vjudge404>Facebook</a></li></ol></div></footer><div style=display:none><script src="//s95.cnzz.com/z_stat.php?id=1256463916&web_id=1256463916"></script></div></body></html>